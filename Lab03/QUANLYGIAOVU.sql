-- DATABASE QUAN LY GIAO VU
CREATE DATABASE QUANLYGIAOVU
GO

USE QUANLYGIAOVU
GO

--   CAU 1
-- BANG KHOA
CREATE TABLE KHOA
(
	MAKHOA VARCHAR(4) NOT NULL,
	TENKHOA VARCHAR(40),
	NGTLAP SMALLDATETIME,
	TRGKHOA CHAR(4),
	CONSTRAINT PK_KHOA PRIMARY KEY (MAKHOA),
)
GO

-- BANG MONHOC
CREATE TABLE MONHOC
(
	MAMH VARCHAR(10) NOT NULL,
	TENMH VARCHAR(40),
	TCLT TINYINT,
	TCTH TINYINT,
	MAKHOA VARCHAR(4),
	CONSTRAINT PK_MONHOC PRIMARY KEY (MAMH),
)
GO

-- BANG DIEUKIEN
CREATE TABLE DIEUKIEN
(
	MAMH VARCHAR(10),
	MAMH_TRUOC VARCHAR(10),
	CONSTRAINT PK_DIEUKIEN PRIMARY KEY (MAMH, MAMH_TRUOC),
)
GO

-- BANG GIAOVIEN
CREATE TABLE GIAOVIEN
(
	MAGV CHAR(4) NOT NULL,
	HOTEN VARCHAR(40),
	HOCVI VARCHAR(10),
	HOCHAM VARCHAR(10),
	GIOITINH VARCHAR(3),
	NGSINH SMALLDATETIME,
	NGVL SMALLDATETIME,
	HESO NUMERIC(4,2),
	MUCLUONG MONEY,
	MAKHOA VARCHAR(4),
	CONSTRAINT PK_GIAOVIEN PRIMARY KEY (MAGV),
)
GO

-- BANG HOCVIEN
CREATE TABLE HOCVIEN
(
	MAHV CHAR(5) NOT NULL,
	HO VARCHAR(40),
	TEN VARCHAR(10),
	NGSINH SMALLDATETIME,
	GIOITINH VARCHAR(3),
	NOISINH VARCHAR(40),
	MALOP CHAR(3),
	CONSTRAINT PK_MAHV PRIMARY KEY (MAHV),
)
GO

-- BANG LOP
CREATE TABLE LOP
(
	MALOP CHAR(3) NOT NULL,
	TENLOP VARCHAR(40),
	TRGLOP CHAR(5),
	SISO TINYINT,
	MAGVCN CHAR(4),
	CONSTRAINT PK_LOP PRIMARY KEY (MALOP),
)
GO

-- BANG GIANGDAY
CREATE TABLE GIANGDAY
(
	MALOP CHAR(3),
	MAMH VARCHAR(10),
	MAGV CHAR(4),
	HOCKY TINYINT,
	NAM SMALLINT,
	TUNGAY SMALLDATETIME,
	DENNGAY SMALLDATETIME,
	CONSTRAINT PK_GIANGDAY PRIMARY KEY (MALOP, MAMH),
)
GO


-- BANG KETQUATHI
CREATE TABLE KETQUATHI
(
	MAHV CHAR(5),
	MAMH VARCHAR(10),
	LANTHI TINYINT,
	NGTHI SMALLDATETIME,
	DIEM NUMERIC(4,2),
	KQUA VARCHAR(10),
	CONSTRAINT PK_KETQUATHI PRIMARY KEY (MAHV, MAMH, LANTHI),
)
GO

-- TAO KHOA NGOAI
-- TAO RIENG DO KHI TAO CHUNG CO NHUNG BANG CHUA DUOC KHOI TAO THI KHONG KET NOI KHOA NGOAI DUOC

-- KHOA NGOAI LOP
ALTER TABLE LOP
ADD CONSTRAINT FK_TRGLOP FOREIGN KEY (TRGLOP) REFERENCES HOCVIEN(MAHV)
ALTER TABLE LOP 
ADD	CONSTRAINT FK_MAGVCN FOREIGN KEY (MAGVCN) REFERENCES GIAOVIEN(MAGV)

-- KHOA NGOAI HOCVIEN
ALTER TABLE HOCVIEN
ADD CONSTRAINT FK_MALOPHV FOREIGN KEY (MALOP) REFERENCES LOP(MALOP)

-- KHOA NGOAI GIAOVIEN
ALTER TABLE GIAOVIEN
ADD CONSTRAINT FK_MAKHOAGV FOREIGN KEY (MAKHOA) REFERENCES KHOA(MAKHOA)

-- KHOA NGOAI GIANGDAY
ALTER TABLE GIANGDAY
ADD CONSTRAINT FK_MAMHGD FOREIGN KEY (MAMH) REFERENCES MONHOC(MAMH)
ALTER TABLE GIANGDAY
ADD CONSTRAINT FK_MALOP FOREIGN KEY (MALOP) REFERENCES LOP(MALOP)

-- KHOA NGOAI KHOA
ALTER TABLE KHOA
ADD CONSTRAINT FK_TRGKHOA FOREIGN KEY (TRGKHOA) REFERENCES GIAOVIEN(MAGV)

-- KHOA NGOAI MONHOC
ALTER TABLE MONHOC
ADD CONSTRAINT FK_MAKHOAMH FOREIGN KEY (MAKHOA) REFERENCES KHOA(MAKHOA)

-- KHOA NGOAI DIEUKIEN
ALTER TABLE DIEUKIEN
ADD CONSTRAINT FK_MAMH_TRUOC FOREIGN KEY (MAMH_TRUOC) REFERENCES MONHOC(MAMH)
ALTER TABLE DIEUKIEN
ADD CONSTRAINT FK_MAMHDK FOREIGN KEY (MAMH) REFERENCES MONHOC(MAMH)

-- KHOA NGOAI KETQUATHI
ALTER TABLE KETQUATHI
ADD CONSTRAINT FK_MAHV FOREIGN KEY (MAHV) REFERENCES HOCVIEN(MAHV)
ALTER TABLE KETQUATHI
ADD CONSTRAINT FK_MAMHKQT FOREIGN KEY (MAMH) REFERENCES MONHOC(MAMH)

--   CAU 3
ALTER TABLE GIAOVIEN
ADD CONSTRAINT CHK_GIOITINHGV CHECK (GIOITINH IN ('Nam', 'Nu'))
ALTER TABLE HOCVIEN
ADD CONSTRAINT CHK_GIOITINHHV CHECK (GIOITINH IN ('Nam', 'Nu'))

--   CAU 4
ALTER TABLE KETQUATHI 
ADD CONSTRAINT CHECK_DIEM CHECK (DIEM BETWEEN 0 AND 10 AND RIGHT(CAST(DIEM AS VARCHAR), 3) LIKE '.__')

--   CAU 5
ALTER TABLE KETQUATHI 
ADD CONSTRAINT CHECK_KETQUA CHECK ((KQUA = 'Dat' AND DIEM BETWEEN 5 AND 10) OR (KQUA = 'Khong dat' AND DIEM < 5))

--   CAU 6
ALTER TABLE KETQUATHI
ADD CONSTRAINT CHK_LANTHI CHECK (LANTHI <= 3)

--   CAU 7
ALTER TABLE GIANGDAY
ADD CONSTRAINT CHK_GIANGDAY CHECK (HOCKY BETWEEN 1 AND 3)

--   CAU 8
ALTER TABLE GIAOVIEN
ADD CONSTRAINT CHK_HOCVI CHECK (HOCVI IN ('CN', 'KS', 'Ths', 'TS', 'PTS'))

--                II. NGON NGU THAO TAC DU LIEU(DATA MANIPULATION LANGUAGE)
--   NHAP DU LIEU

SET DATEFORMAT DMY

-- BANG KHOA
INSERT INTO KHOA (MAKHOA, TENKHOA, NGTLAP) VALUES ('KHMT', 'Khoa Hoc May Tinh', '7/6/2005')
INSERT INTO KHOA (MAKHOA, TENKHOA, NGTLAP) VALUES ('HTTT', 'He thong thong tin', '7/6/2005')
INSERT INTO KHOA (MAKHOA, TENKHOA, NGTLAP) VALUES ('CNPM', 'Cong nghe phan mem', '7/6/2005')
INSERT INTO KHOA (MAKHOA, TENKHOA, NGTLAP) VALUES ('MTT', 'Mang va truyen thong', '7/6/2005')
INSERT INTO KHOA (MAKHOA, TENKHOA, NGTLAP) VALUES ('KTMT', 'Ky thuat may tinh', '7/6/2005')

-- BANG GIAOVIEN
INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV01', 'Ho Thanh Son', 'PTS', 'GS', 'Nam', '2/5/1950', '1/11/2004', 5.00, 2250000, 'KHMT')
INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV02', 'Tran Tam Thanh', 'TS', 'PGS', 'Nam', '17/12/1965', '20/4/2004', 4.50, 2025000, 'HTTT')
INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV03', 'Do Nghiem Phung', 'TS', 'GS', 'Nu', '1/8/1950', '23/9/2004', 4.00, 1800000, 'CNPM')
INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV04', 'Tran Nam Son', 'TS', 'PGS', 'Nam', '22/2/1961', '12/1/2005', 4.50, 2025000, 'KTMT')
INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV05', 'Mai Thanh Danh', 'ThS', 'GV', 'Nam', '12/3/1958', '12/1/2005', 3.00, 1350000, 'HTTT')
INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV06', 'Tran Doan Hung', 'TS', 'GV', 'Nam', '11/3/1953', '12/1/2005', 4.50, 2025000, 'KHMT')
INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV07', 'Nguyen Minh Tien', 'ThS', 'GV', 'Nam', '23/11/1971', '1/3/2005', 4.00, 1800000, 'KHMT')
INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV08', 'Le Thi Tran', 'KS', Null, 'Nu', '26/3/1974', '1/3/2005', 1.69, 760500, 'KHMT')
INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV09', 'Nguyen To Lan', 'ThS', 'GV', 'Nu', '31/12/1966', '1/3/2005', 4.00, 1800000, 'HTTT')
INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV10', 'Le Tran Anh Loan', 'KS', Null, 'Nu', '17/7/1972', '1/3/2005', 1.86, 837000, 'CNPM')
INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV11', 'Ho Thanh Tung', 'CN', 'GV', 'Nam', '12/1/1980', '15/5/2005', 2.67, 1201500, 'MTT')
INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV12', 'Tran Van Anh', 'CN', Null, 'Nu', '29/3/1981', '15/5/2005', 1.69, 760500, 'CNPM')
INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV13', 'Nguyen Linh Dan', 'CN', Null, 'Nu', '23/5/1980', '15/5/2005', 1.69, 760500, 'KTMT')
INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV14', 'Truong Minh Chau', 'ThS', 'GV', 'Nu', '30/11/1976', '15/5/2005', 3.00, 1350000, 'MTT')
INSERT INTO GIAOVIEN (MAGV, HOTEN, HOCVI, HOCHAM, GIOITINH, NGSINH, NGVL, HESO, MUCLUONG, MAKHOA) VALUES ('GV15', 'Le Ha Thanh', 'ThS', 'GV', 'Nam', '4/5/1978', '15/5/2005', 3.00, 1350000, 'KHMT')

-- THEM TRGKHOA
-- DO KHI NHAP KHOA THI CHUA CO GIAO VIEN DE LIEN KET KHOA NGOAI
UPDATE KHOA SET TRGKHOA = 'GV01' WHERE MAKHOA = 'KHMT'
UPDATE KHOA SET TRGKHOA = 'GV02' WHERE MAKHOA = 'HTTT'
UPDATE KHOA SET TRGKHOA = 'GV04' WHERE MAKHOA = 'CNPM'
UPDATE KHOA SET TRGKHOA = 'GV03' WHERE MAKHOA = 'MTT'

-- BANG LOP
INSERT INTO LOP (MALOP, TENLOP, SISO, MAGVCN) VALUES ('K11', 'Lop 1 khoa 1', 11, 'GV07')
INSERT INTO LOP (MALOP, TENLOP, SISO, MAGVCN) VALUES ('K12', 'Lop 2 khoa 1', 12, 'GV09')
INSERT INTO LOP (MALOP, TENLOP, SISO, MAGVCN) VALUES ('K13', 'Lop 3 khoa 1', 12, 'GV14')

-- BANG MONHOC
-- NHUNG MON CO CHECNH LECH TIN CHI NHIEU SE BI BO
INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('THDC', 'Tin hoc dai cuong', 4, 1, 'KHMT')
INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('CTRR', 'Cau truc roi rac', 5, 0, 'KHMT')
INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('CSDL', 'Co so du lieu', 3, 1, 'HTTT')
INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('CTDLGT', 'Cau truc du lieu va giai thuat', 3, 1, 'KHMT')
INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('PTTKTT', 'Phan tich thiet ke thuat toan', 3, 0, 'KHMT')
INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('DHMT', 'Do hoa may tinh', 3, 1, 'KHMT')
INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('KTMT', 'Kien truc may tinh', 3, 1, 'KTMT')
INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('TKCSDL', 'Thiet ke co so du lieu', 3, 0, 'HTTT')
INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('PTTKHTTT', 'Phan tich thiet ke he thong thong tin', 4, 1, 'HTTT')
INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('HDH', 'He dieu hanh', 4, 0, 'KTMT')
INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('NMCNPM', 'Nhap mon cong nghe phan mem', 3, 0, 'CNPM')
INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('LTCFW', 'Lap trinh C for win', 3, 1, 'CNPM')
INSERT INTO MONHOC (MAMH, TENMH, TCLT, TCTH, MAKHOA) VALUES ('LTHDT', 'Lap trinh huong doi tuong', 3, 1, 'CNPM')

-- BANG HOCVIEN
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1101', 'Nguyen Van', 'A', '27/1/1986', 'Nam','TpHCM', 'K11')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1102', 'Tran Ngoc', 'Han', '14/3/1986', 'Nu','Kien Giang', 'K11')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1103', 'Ha Duy', 'Lap', '18/4/1986', 'Nam','Nghe An', 'K11')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1104', 'Tran Ngoc', 'Linh', '30/3/1986', 'Nu','Tay Ninh', 'K11')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1105', 'Tran Minh', 'Long', '27/2/1986', 'Nam','TpHCM', 'K11')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1106', 'Le Nhat', 'Minh', '24/1/1986', 'Nam','TpHCM', 'K11')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1107', 'Nguyen Nhu', 'Nhut', '27/1/1986', 'Nam','Ha Noi', 'K11')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1108', 'Nguyen Manh', 'Tam', '27/2/1986', 'Nam','Kien Giang', 'K11')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1109', 'Phan Thi Thanh', 'Tam', '27/1/1986', 'Nu','Vinh Long', 'K11')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1110', 'Le Hoai', 'Thuong', '5/2/1986', 'Nu','Can Tho', 'K11')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1111', 'Le Ha', 'Vinh', '25/12/1986', 'Nam','Vinh Long', 'K11')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1201', 'Nguyen Van', 'B', '11/2/1986', 'Nam','TpHCM', 'K12')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1202', 'Nguyen Thi Kim', 'Duyen', '18/11/1986', 'Nu','TpHCM', 'K12')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1203', 'Tran Thi Kim', 'Duyen', '17/9/1986', 'Nu','TpHCM', 'K12')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1204', 'Truong My', 'Hanh', '19/5/1986', 'Nu','Dong Nai', 'K12')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1205', 'Nguyen Thanh', 'Nam', '17/4/1986', 'Nam','TpHCM', 'K12')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1206', 'Nguyen Thi Truc', 'Thanh', '4/3/1986', 'Nu','Kien Giang', 'K12')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1207', 'Tran Thi Bich', 'Thuy', '8/2/1986', 'Nu','Nghe An', 'K12')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1208', 'Huynh Thi Kim', 'Trieu', '8/4/1986', 'Nu','Tay Ninh', 'K12')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1209', 'Pham Thanh', 'Trieu', '23/2/1986', 'Nam','TpHCM', 'K12')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1210', 'Ngo Thanh', 'Tuan', '14/2/1986', 'Nam','TpHCM', 'K12')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1211', 'Do Thi', 'Xuan', '9/3/1986', 'Nu','Ha Noi', 'K12')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1212', 'Le Thi Phi', 'Yen', '12/3/1986', 'Nu','TpHCM', 'K12')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1301', 'Nguyen Thi Kim', 'Cuc', '9/6/1986', 'Nu','Kien Giang', 'K13')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1302', 'Truong Thi My', 'Hien', '18/3/1986', 'Nu','Nghe An', 'K13')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1303', 'Le Duc', 'Hien', '21/3/1986', 'Nam','Tay Ninh', 'K13')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1304', 'Le Quang', 'Hien', '18/4/1986', 'Nam','TpHCM', 'K13')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1305', 'Le Thi', 'Huong', '27/3/1986', 'Nu','TpHCM', 'K13')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1306', 'Nguyen Thai', 'Huu', '30/3/1986', 'Nam','Ha Noi', 'K13')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1307', 'Tran Minh', 'Man', '28/5/1986', 'Nam','TpHCM', 'K13')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1308', 'Nguyen Hieu', 'Nghia', '8/4/1986', 'Nam','Kien Giang', 'K13')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1309', 'Nguyen Trung', 'Nghia', '18/1/1987', 'Nam','Nghe An', 'K13')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1310', 'Tran Thi Hong', 'Than', '22/4/1986', 'Nu','Tay Ninh', 'K13')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1311', 'Tran Minh', 'Thuc', '4/4/1986', 'Nam','TpHCM', 'K13')
INSERT INTO HOCVIEN (MAHV, HO, TEN, NGSINH, GIOITINH, NOISINH, MALOP) VALUES ('K1312', 'Nguyen Thi Kim', 'Yen', '7/9/1986', 'Nu','TpHCM', 'K13')

-- THEM TRGLOP
-- DO KHI NHAP LOP THI CHUA CO HOCVIEN DE LIEN KET KHOA NGOAI
UPDATE LOP SET TRGLOP = 'K1108' WHERE MALOP = 'K11'
UPDATE LOP SET TRGLOP = 'K1205' WHERE MALOP = 'K12'
UPDATE LOP SET TRGLOP = 'K1305' WHERE MALOP = 'K13'

-- BANG DIEUKIEN
INSERT INTO DIEUKIEN (MAMH, MAMH_TRUOC) VALUES ('CSDL', 'CTRR')
INSERT INTO DIEUKIEN (MAMH, MAMH_TRUOC) VALUES ('CSDL', 'CTDLGT')
INSERT INTO DIEUKIEN (MAMH, MAMH_TRUOC) VALUES ('CTDLGT', 'THDC')
INSERT INTO DIEUKIEN (MAMH, MAMH_TRUOC) VALUES ('PTTKTT', 'THDC')
INSERT INTO DIEUKIEN (MAMH, MAMH_TRUOC) VALUES ('PTTKTT', 'CTDLGT')
INSERT INTO DIEUKIEN (MAMH, MAMH_TRUOC) VALUES ('DHMT', 'THDC')
INSERT INTO DIEUKIEN (MAMH, MAMH_TRUOC) VALUES ('LTHDT', 'THDC')
INSERT INTO DIEUKIEN (MAMH, MAMH_TRUOC) VALUES ('PTTKHTTT', 'CSDL')

-- BANG KETQUATHI
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1101','CSDL', 1, '20/7/2006', 10.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1101', 'CTDLGT', 1,  '28/12/2006', 9.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1101', 'THDC', 1, '20/5/2006', 9.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1101', 'CTRR', 1, '13/5/2006', 9.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1102', 'CSDL', 1, '20/7/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1102', 'CSDL', 2, '27/7/2006', 4.25, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1102', 'CSDL', 3, '10/8/2006', 4.50, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1102', 'CTDLGT', 1, '28/12/2006', 4.50, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1102', 'CTDLGT', 2, '5/1/2007', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1102', 'CTDLGT', 3, '15/1/2007', 6.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1102', 'THDC', 1, '20/5/2006', 5.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1102', 'CTRR', 1, '13/5/2006',7.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1103', 'CSDL', 1, '20/7/2006', 3.50, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1103', 'CSDL', 2, '27/7/2006', 8.25, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1103', 'CTDLGT', 1, '28/12/2006', 7.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1103', 'THDC', 1, '20/5/2006', 8.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1103', 'CTRR', 1, '13/5/2006', 6.50, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1104', 'CSDL', 1, '20/7/2006', 3.75, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1104', 'CTDLGT', 1, '28/12/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1104', 'CTRR', 1, '20/5/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1104', 'THDC', 1, '13/5/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1104', 'CTRR', 2, '20/5/2006', 3.50, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1104', 'CTRR', 3, '30/5/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1201', 'CSDL', 1, '20/7/2006', 6.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1201', 'CTDLGT', 1, '28/12/2006', 5.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1201', 'THDC', 1, '20/5/2006', 8.50, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1201', 'CTRR', 1, '13/5/2006', 9.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1202', 'CSDL', 1, '20/7/2006', 8.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1202', 'CTDLGT', 1, '28/12/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1202', 'CTDLGT', 2, '5/1/2007', 5.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1202', 'THDC', 1, '20/5/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1202', 'THDC', 2, '27/5/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1202', 'CTRR', 1, '13/5/2006', 3.00, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1202', 'CTRR', 2, '20/5/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1202', 'CTRR', 3, '30/6/2006', 6.25, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1203', 'CSDL', 1, '20/7/2006', 9.25, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1203', 'CTDLGT', 1, '28/12/2006', 9.50, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1203', 'THDC', 1, '20/5/2006', 10.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1203', 'CTRR', 1, '13/5/2006', 10.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1204', 'CSDL', 1, '20/7/2006', 8.50, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1204', 'CTDLGT', 1, '28/12/2006', 6.75, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1204', 'THDC', 1, '20/5/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1204', 'CTRR', 1, '13/5/2006', 6.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1301', 'CSDL', 1, '20/12/2006', 4.25, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1301', 'CTDLGT', 1, '25/7/2006', 8.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1301', 'THDC', 1, '20/5/2006', 7.75, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1301', 'CTRR', 1, '13/5/2006', 8.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1302', 'CSDL', 1, '20/12/2006', 6.75, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1302', 'CTDLGT', 1, '25/7/2006', 5.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1302', 'THDC', 1, '20/5/2006', 8.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1302', 'CTRR', 1, '13/5/2006', 8.50, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1303', 'CSDL', 1, '20/12/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1303', 'CTDLGT', 1, '25/7/2006', 4.50, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1303', 'CTDLGT', 2, '7/8/2006', 4.00, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1303', 'CTDLGT', 3, '15/8/2006', 4.25, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1303', 'THDC', 1, '20/5/2006', 4.50, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1303', 'CTRR', 1, '13/5/2006', 3.25, 'Khong Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1303', 'CTRR', 2, '20/5/2006', 5.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1304', 'CSDL', 1, '20/12/2006', 7.75, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1304', 'CTDLGT', 1, '25/7/2006', 9.75, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1304', 'THDC', 1, '20/5/2006', 5.50, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1304', 'CTRR', 1, '13/5/2006', 5.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1305', 'CSDL', 1, '20/12/2006', 9.25, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1305', 'CTDLGT', 1, '25/7/2006', 10.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1305', 'THDC', 1, '20/5/2006', 8.00, 'Dat')
INSERT INTO KETQUATHI (MAHV, MAMH, LANTHI, NGTHI, DIEM, KQUA) VALUES ('K1305', 'CTRR', 1, '13/5/2006', 10.00, 'Dat')

-- BANG GIANGDAY
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K11', 'THDC', 'GV07', 1, 2006, '2/1/2006', '12/5/2006')
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K12', 'THDC', 'GV06', 1, 2006, '2/1/2006', '12/5/2006')
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K13', 'THDC', 'GV15', 1, 2006, '2/1/2006', '12/5/2006')
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K11', 'CTRR', 'GV02', 1, 2006, '9/1/2006', '17/5/2006')
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K12', 'CTRR', 'GV02', 1, 2006, '9/1/2006', '17/5/2006')
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K13', 'CTRR', 'GV08', 2, 2006, '9/1/2006', '17/5/2006')
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K11', 'CSDL', 'GV05', 2, 2006, '1/6/2006', '15/7/2006')
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K12', 'CSDL', 'GV09', 2, 2006, '1/6/2006', '15/7/2006')
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K13', 'CTDLGT', 'GV15', 2, 2006, '1/6/2006', '15/7/2006')
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K13', 'CSDL', 'GV05', 3, 2006, '1/8/2006', '15/12/2006')
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K13', 'DHMT', 'GV07', 3, 2006, '1/8/2006', '15/12/2006')
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K11', 'CTDLGT', 'GV15', 3, 2006, '1/8/2006', '15/12/2006')
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K12', 'CTDLGT', 'GV15', 3, 2006, '1/8/2006', '15/12/2006')
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K11', 'HDH', 'GV04', 1, 2007, '2/1/2007', '18/2/2007')
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K12', 'HDH', 'GV04', 1, 2007, '2/1/2007', '20/3/2007')
INSERT INTO GIANGDAY(MALOP, MAMH, MAGV, HOCKY, NAM, TUNGAY, DENNGAY) VALUES ('K11', 'DHMT', 'GV07', 1, 2007, '2/1/2007', '20/3/2007')

--              I. NGON NGU DINH NGHIA DU LIEU (DATA DEFINITION LANGUAGE)
--   CAU 11
ALTER TABLE HOCVIEN
ADD CONSTRAINT CHECK_TUOIHV CHECK (YEAR(GETDATE()) - YEAR(NGSINH) >= 18)

--   CAU 12
ALTER TABLE GIANGDAY
ADD CONSTRAINT CHECK__TGDAY CHECK (TUNGAY < DENNGAY)

--   CAU 13
ALTER TABLE GIAOVIEN
ADD CONSTRAINT CHECK_TUOIGV CHECK (YEAR(NGVL) - YEAR(NGSINH) >= 22)

--   CAU 14
-- VI CHECK DUOC THEM VAO SAU NEN KHI NHAP, GAP LOI BEN TREN THI DUOI NAY H KHONG THE TAO DUOC CHECK NAY
-- EM THEM WITH NOCHECK DE KE TU GIO NEU THEM VAO SAU NO SE CHECK LOI CON NHUNG DU LIEU TRUOC BO QUA, DE CHECK NAY DUOC TAO
ALTER TABLE MONHOC WITH NOCHECK
ADD CONSTRAINT CHECK_TINCHI CHECK (ABS(TCLT - TCTH) <= 3)


--                III. NGON NGU TRUY VAN DU LIEU
--   CAU 1
SELECT MAHV, (HO+' '+TEN)HOTEN, NGSINH, HOCVIEN.MALOP
FROM HOCVIEN, LOP
WHERE HOCVIEN.MAHV = LOP.TRGLOP

--   CAU 2
SELECT KQT.MAHV, (HO+' '+TEN)HOTEN, LANTHI, DIEM
FROM KETQUATHI KQT, HOCVIEN HV
WHERE KQT.MAHV = HV.MAHV AND MAMH = 'CTRR' AND MALOP = 'K12'
ORDER BY TEN, HO

--   CAU 3
SELECT KQT.MAHV, (HO+' '+TEN)HOTEN, TENMH
FROM KETQUATHI KQT, HOCVIEN HV, MONHOC MH
where KQT.MAHV = HV.MAHV AND KQT.MAMH = MH.MAMH AND LANTHI = 1 AND KQUA = 'Dat'

--   CAU 4		
SELECT KQT.MAHV, (HO+' '+TEN)HOTEN
FROM KETQUATHI KQT, HOCVIEN HV
WHERE KQT.MAHV= HV.MAHV AND HV.MALOP = 'K11' AND LANTHI = 1 AND KQUA = 'Khong Dat' AND MAMH = 'CTRR'

--   CAU 5
SELECT DISTINCT KQT.MAHV, (HO+' '+TEN)HOTEN, MALOP
FROM KETQUATHI KQT, HOCVIEN HV
WHERE HV.MAHV = KQT.MAHV AND MaLop like 'K%' AND MaMH = 'CTRR' AND NOT EXISTS ( SELECT * 
																				FROM KetQuaThi
																				WHERE KQua = 'Dat' AND MaMH = 'CTRR' AND MaHV = HV.MAHV)

--                II. NGON NGU THAO TAC DU LIEU (DATA MANIPULATION LANGUAGE)
--  CAU 1
UPDATE GIAOVIEN
SET HESO = 0.2 + HESO
WHERE MAGV IN (SELECT TRGKHOA FROM KHOA)

--  CAU 2
ALTER TABLE HOCVIEN
ADD DIEMTB NUMERIC(4,2)
GO

UPDATE HocVien
SET DIEMTB= ( SELECT AVG(DIEM)
			   FROM KETQUATHI
			   WHERE LANTHI= (SELECT MAX(LANTHI) 
							   FROM KETQUATHI KQT
							   WHERE MAHV = KETQUATHI.MAHV 
							   GROUP BY MAHV)
			   GROUP BY MAHV
			   HAVING MAHV= HOCVIEN.MAHV )

--  CAU 3
ALTER TABLE HOCVIEN
ADD GHICHU VARCHAR(40)
GO

UPDATE HOCVIEN
SET GHICHU = 'Cam thi'
WHERE MAHV IN ( SELECT MAHV
				FROM KETQUATHI
				WHERE LANTHI = 3 AND DIEM < 5)

--  CAU 4
ALTER TABLE HOCVIEN
ADD XEPLOAI VARCHAR(10)
GO

UPDATE HOCVIEN
SET XEPLOAI = ( CASE 
					WHEN DIEMTB >= 9 THEN 'XS'
					WHEN DIEMTB >= 8 AND DIEMTB < 9 THEN 'G'
					WHEN DIEMTB >= 6.5 AND DIEMTB < 8 THEN 'K'
					WHEN DIEMTB >= 5 AND DIEMTB < 6.5 THEN 'TB'
					WHEN DIEMTB < 5 THEN 'Y'
				END )
--                III. NGON NGU TRUY VAN DU LIEU
--  CAU 6
SELECT DISTINCT TENMH
FROM MONHOC, GIAOVIEN, GIANGDAY
WHERE MONHOC.MAMH = GIANGDAY.MAMH
	AND GIAOVIEN.MAGV = GIANGDAY.MAGV
	AND HOTEN = 'Tran Tam Thanh'
	AND HOCKY = 1 AND NAM = 2006

--  CAU 7
SELECT DISTINCT MONHOC.MAMH, TENMH
FROM MONHOC, LOP, GIANGDAY
WHERE GIANGDAY.MAMH = MONHOC.MAMH
	AND GIANGDAY.MAGV = LOP.MAGVCN
	AND LOP.MALOP = 'K11'
	AND HOCKY = 1 AND NAM = 2006

--  CAU 8
SELECT DISTINCT (HO + ' ' + TEN) HOTEN
FROM HOCVIEN, LOP, GIAOVIEN, GIANGDAY, MONHOC
WHERE LOP.TRGLOP = HOCVIEN.MAHV
	AND GIANGDAY.MALOP = LOP.MALOP
	AND GIANGDAY.MAGV = GIAOVIEN.MAGV
	AND GIANGDAY.MAMH = MONHOC.MAMH
	AND HOTEN = 'Nguyen To Lan'
	AND TENMH = 'Co So Du Lieu'

--  CAU 9
SELECT MONHOCTRUOC.MAMH, MONHOCTRUOC.TENMH
FROM MONHOC, MONHOC AS MONHOCTRUOC, DIEUKIEN
WHERE MONHOC.MAMH = DIEUKIEN.MAMH
	AND MONHOCTRUOC.MAMH = DIEUKIEN.MAMH_TRUOC
	AND MONHOC.TENMH = 'Co So Du Lieu'

--  CAU 10
SELECT MONHOC.MAMH, MONHOC.TENMH
FROM MONHOC, MONHOC AS MONHOCTRUOC, DIEUKIEN
WHERE
	MONHOC.MAMH = DIEUKIEN.MAMH
	AND MONHOCTRUOC.MAMH = DIEUKIEN.MAMH_TRUOC
	AND MONHOCTRUOC.TENMH = 'Cau Truc Roi Rac'

--  CAU 11
SELECT HOTEN
FROM GIAOVIEN, GIANGDAY
WHERE GIAOVIEN.MAGV = GIANGDAY.MAGV
	AND MALOP = 'K11'
	AND HOCKY = 1 AND NAM = 2006
INTERSECT ( SELECT HOTEN
			FROM GIAOVIEN, GIANGDAY
			WHERE GIAOVIEN.MAGV = GIANGDAY.MAGV
				AND MALOP = 'K12' AND HOCKY = 1 AND NAM = 2006 )

--  CAU 12
SELECT HOCVIEN.MAHV, (HO + ' ' + TEN) HOTEN
FROM HOCVIEN, KETQUATHI
WHERE HOCVIEN.MAHV = KETQUATHI.MAHV
	AND MAMH = 'CSDL' AND LANTHI = 1 AND KQUA = 'Khong Dat'
	AND NOT EXISTS ( SELECT * 
					 FROM KETQUATHI 
					 WHERE LANTHI > 1 
						AND KETQUATHI.MAHV = HOCVIEN.MAHV )

--  CAU 13
SELECT MAGV, HOTEN
FROM GIAOVIEN
WHERE MAGV NOT IN (SELECT MAGV FROM GIANGDAY)

--  CAU 14
SELECT MAGV, HOTEN
FROM GIAOVIEN
WHERE NOT EXISTS ( SELECT *
				   FROM MONHOC
				   WHERE MONHOC.MAKHOA = GIAOVIEN.MAKHOA
					   AND NOT EXISTS ( SELECT *
										FROM GIANGDAY
										WHERE GIANGDAY.MAMH = MONHOC.MAMH
											AND GIANGDAY.MAGV = GIAOVIEN.MAGV ))

--  CAU 15
SELECT DISTINCT (HO + ' ' + TEN) HOTEN
FROM HOCVIEN, KETQUATHI
WHERE HOCVIEN.MAHV = KETQUATHI.MAHV
	AND MALOP = 'K11'
	AND ((LANTHI = 2 AND DIEM = 5)
	OR HOCVIEN.MAHV IN ( SELECT DISTINCT MAHV
						 FROM KETQUATHI
						 WHERE KQUA = 'Khong Dat'
						 GROUP BY MAHV, MAMH
						 HAVING COUNT(*) > 3 ))

--  CAU 16
SELECT HOTEN
FROM GIAOVIEN, GIANGDAY
WHERE GIAOVIEN.MAGV = GIANGDAY.MAGV
	AND MAMH = 'CTRR'
GROUP BY GIAOVIEN.MAGV, HOTEN, HOCKY
HAVING COUNT(*) >= 2

--  CAU 17
SELECT HOCVIEN.*, DIEM AS 'Diem thi CSDL sau cung'
FROM HOCVIEN, KETQUATHI
WHERE
	HOCVIEN.MAHV = KETQUATHI.MAHV
	AND MAMH = 'CSDL'
	AND LANTHI = ( SELECT MAX(LANTHI) 
				   FROM KETQUATHI 
				   WHERE MAMH = 'CSDL' AND KETQUATHI.MAHV = HOCVIEN.MAHV 
				   GROUP BY MAHV )

--  CAU 18
SELECT HOCVIEN.*, DIEM AS 'Diem thi CSDL cao nhat'
FROM HOCVIEN, KETQUATHI, MONHOC
WHERE HOCVIEN.MAHV = KETQUATHI.MAHV
	AND KETQUATHI.MAMH = MONHOC.MAMH
	AND TENMH = 'Co So Du Lieu'
	AND DIEM = ( SELECT MAX(DIEM) 
				 FROM KETQUATHI, MONHOC
				 WHERE KETQUATHI.MAMH = MONHOC.MAMH
					 AND MAHV = HOCVIEN.MAHV
					 AND TENMH = 'Co So Du Lieu'
				 GROUP BY MAHV )

--  CAU 19
SELECT MAKHOA, TENKHOA, NGTLAP
FROM KHOA
WHERE NGTLAP = (SELECT MIN(NGTLAP)
				FROM KHOA)

--  CAU 20
SELECT COUNT(*) SL_GV_GS_PGS
FROM GIAOVIEN
WHERE HOCHAM IN ('GS', 'PGS')

--  CAU 21
SELECT MAKHOA, HOCVI, COUNT(HOCVI) AS SOLUONG
FROM GIAOVIEN
WHERE HOCVI IN ('CN', 'KS', 'Ths', 'TS', 'PTS')
GROUP BY MAKHOA, HOCVI
ORDER BY MAKHOA

--  CAU 22
SELECT MONHOC.MAMH, MONHOC.TENMH, KETQUATHI.KQUA, COUNT(DISTINCT KETQUATHI.MAHV) AS SOLUONG
FROM MONHOC, KETQUATHI
WHERE MONHOC.MAMH = KETQUATHI.MAMH
GROUP BY MONHOC.MAMH, MONHOC.TENMH, KETQUATHI.KQUA
ORDER BY MONHOC.MAMH

--  CAU 23
SELECT DISTINCT GIAOVIEN.*
FROM GIAOVIEN, LOP, GIANGDAY
WHERE GIANGDAY.MALOP = LOP.MALOP
	AND GIANGDAY.MAGV = GIAOVIEN.MAGV
	AND GIAOVIEN.MAGV = LOP.MAGVCN

--  CAU 24
SELECT HO + ' ' + TEN HOTEN_LOPTRUONG_LOP_MAX_SISO
FROM HOCVIEN, LOP
WHERE
	HOCVIEN.MAHV = LOP.TRGLOP
	AND LOP.SISO = (SELECT MAX(SISO) 
				    FROM LOP)

--  CAU 25
SELECT HO + ' ' + TEN HOTEN_LOPTRUONG_THI_KHONGDAT_HON_3_MON, COUNT(DISTINCT MAMH)
FROM HOCVIEN, LOP, KETQUATHI
WHERE
	HOCVIEN.MAHV = KETQUATHI.MAHV
	AND KQUA = 'Khong Dat'
GROUP BY 
	HO, TEN
HAVING 
	COUNT(DISTINCT MAMH) > 3

--  CAU 26
SELECT TOP 1 WITH TIES  HOCVIEN.MAHV, (HO+' '+TEN) AS HOTEN
FROM HOCVIEN, KETQUATHI
WHERE HOCVIEN.MAHV = KETQUATHI.MAHV
	AND DIEM >= 9
GROUP BY HOCVIEN.MAHV, HO, TEN
ORDER BY COUNT(*) DESC

--  CAU 27
SELECT MALOP, MAHV, HOTEN
FROM (SELECT MALOP, HOCVIEN.MAHV, (HO+' '+TEN) HOTEN, COUNT(*) SOLUONGDIEM, RANK() OVER (PARTITION BY MALOP ORDER BY COUNT(*) DESC) AS XEPHANG
	  FROM HOCVIEN, KETQUATHI
	  WHERE HOCVIEN.MAHV = KETQUATHI.MAHV
		  AND DIEM >= 9
	  GROUP BY MALOP, HOCVIEN.MAHV, HO, TEN) AS A
WHERE A.XEPHANG = 1

--  CAU 28
SELECT MAGV, COUNT(DISTINCT MAMH) SO_MON_HOC, COUNT(DISTINCT MALOP) SO_LOP
FROM GIANGDAY
GROUP BY MAGV

--  CAU 29
SELECT HOCKY, NAM, A.MAGV, HOTEN
FROM GIAOVIEN, (SELECT HOCKY, NAM, MAGV, RANK() OVER (PARTITION BY HOCKY, NAM ORDER BY COUNT(*) DESC) AS XEPHANG
				FROM GIANGDAY
				GROUP BY HOCKY, NAM, MAGV) AS A
WHERE A.MAGV = GIAOVIEN.MAGV
	AND XepHang = 1
ORDER BY NAM, HOCKY

--  CAU 30
SELECT MONHOC.MAMH, TENMH
FROM MONHOC, KETQUATHI
WHERE MONHOC.MAMH = KETQUATHI.MAMH
	AND LANTHI = 1
	AND KQUA = 'Khong Dat'
GROUP BY  MONHOC.MAMH, TENMH
HAVING COUNT(*) >= ALL (SELECT COUNT(*) 
						FROM KETQUATHI 
						WHERE LANTHI = 1 
							AND KQUA = 'Khong Dat' 
						GROUP BY MAMH)

--  CAU 31
SELECT DISTINCT HOCVIEN.MAHV, (HO+' '+TEN) HOTEN
FROM HOCVIEN, KETQUATHI
WHERE
	HOCVIEN.MAHV = KETQUATHI.MAHV
	AND NOT EXISTS (SELECT *
					FROM KetQuaThi
					WHERE LanThi = 1
						AND KQua = 'Khong Dat'
						AND MaHV = HocVien.MaHV)

--  CAU 32
SELECT DISTINCT HOCVIEN.MAHV, (HO + ' ' + TEN) HOTEN
FROM HOCVIEN, KETQUATHI
WHERE HOCVIEN.MAHV = KETQUATHI.MAHV
	AND NOT EXISTS (SELECT *
					FROM KETQUATHI
					WHERE LANTHI = (SELECT MAX(LanThi) 
									FROM KetQuaThi 
									WHERE MaHV = HocVien.MaHV 
									GROUP BY MaHV)
						AND KQUA = 'Khong Dat'
						AND MAHV = HOCVIEN.MAHV)

--  CAU 33
SELECT MAHV, (HO + ' ' + TEN) HOTEN
FROM HOCVIEN
WHERE NOT EXISTS (SELECT *
				  FROM MonHoc
				  WHERE NOT EXISTS (SELECT *
									FROM KetQuaThi
									WHERE KetQuaThi.MaMH = MonHoc.MaMH
										AND KetQuaThi.MaHV = HocVien.MaHV
										AND LanThi = 1 AND KQua = 'Dat'))

--  CAU 34
SELECT MAHV, (HO + ' ' + TEN) HOTEN
FROM HOCVIEN
WHERE NOT EXISTS (SELECT *
				  FROM MonHoc
				  WHERE NOT EXISTS (SELECT *
									FROM KetQuaThi
									WHERE KetQuaThi.MaMH = MonHoc.MaMH
										AND KetQuaThi.MaHV = HocVien.MaHV
										AND LanThi = (SELECT MAX(LanThi) 
													  FROM KetQuaThi 
													  WHERE MaHV = HocVien.MaHV 
													  GROUP BY MaHV)
										AND KQua = 'Dat'))

--  CAU 35
SELECT MAMH, MAHV, HOTEN
FROM (SELECT MAMH, HOCVIEN.MAHV, (HO + ' ' + TEN) HOTEN, RANK() OVER (PARTITION BY MAMH ORDER BY MAX(DIEM) DESC) AS XEPHANG
	  FROM HOCVIEN, KETQUATHI
	  WHERE HOCVIEN.MAHV = KETQUATHI.MAHV
		  AND LANTHI = (SELECT MAX(LANTHI) 
						FROM KETQUATHI 
						WHERE MAHV = HOCVIEN.MAHV 
						GROUP BY MAHV)
	  GROUP BY MAMH, HOCVIEN.MAHV, HO, TEN) AS A
WHERE XEPHANG = 1
