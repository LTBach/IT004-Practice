-- DATABASE QUANLYBANHANG
CREATE DATABASE QUANLYBANHANG
GO

USE QUANLYBANHANG
GO

--   CAU 1
--BANG KHACHHANG
CREATE TABLE KHACHHANG
(
	MAKH CHAR(4) NOT NULL,
	HOTEN VARCHAR(40),
	DCHI VARCHAR(50),
	SODT VARCHAR(20),
	NGSINH SMALLDATETIME,
	DOANHSO MONEY,
	NGDK SMALLDATETIME,
	CONSTRAINT PK_KH PRIMARY KEY (MAKH),
)
GO

--BAN NHANVIEN
CREATE TABLE NHANVIEN
(
	MANV CHAR(4) NOT NULL,
	HOTEN VARCHAR(40),
	SODT VARCHAR(20),
	NGVL SMALLDATETIME,
	CONSTRAINT PK_NV PRIMARY KEY (MANV),
)
GO

--BANG SANPHAM
CREATE TABLE SANPHAM
(
	MASP CHAR(4) NOT NULL,
	TENSP VARCHAR(40),
	DVT VARCHAR(20),
	NUOCSX VARCHAR(40),
	GIA MONEY,
	CONSTRAINT PK_SP PRIMARY KEY (MASP),
)
GO

--BANG HOADON
CREATE TABLE HOADON
(
	SOHD INT NOT NULL,
	NGHD SMALLDATETIME,
	MAKH CHAR(4),
	MANV CHAR(4),
	TRIGIA MONEY,
	CONSTRAINT PK_HOADON PRIMARY KEY (SOHD),
	CONSTRAINT FK_MAKH FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH),
	CONSTRAINT FK_MANV FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV)
)
GO

--BANG CTHD
CREATE TABLE CTHD 
(
	SOHD INT NOT NULL,
	MASP CHAR(4) NOT NULL,
	SL INT,
	CONSTRAINT PK_CTHD PRIMARY KEY (SOHD, MASP),
	CONSTRAINT FK_SOHD FOREIGN KEY (SOHD) REFERENCES HOADON(SOHD),
	CONSTRAINT FK_MASP FOREIGN KEY (MASP) REFERENCES SANPHAM(MASP),
)
GO

--   CAU 2
ALTER TABLE SANPHAM
ADD GHICHU VARCHAR(20)

--   CAU 3
ALTER TABLE KHACHHANG
ADD LOAIKH TINYINT

--   CAU 4
ALTER TABLE SANPHAM
ALTER COLUMN GHICHU VARCHAR(100)

--   CAU 5
ALTER TABLE SANPHAM
DROP COLUMN GHICHU


--   CAU 6
ALTER TABLE KHACHHANG 
ALTER COLUMN LOAIKH VARCHAR(12)
ALTER TABLE KHACHHANG 
ADD CONSTRAINT CHK_LOAIKH CHECK (LOAIKH IN ('Vang lai', 'Thuong xuyen', 'Vip'))

--   CAU 7
ALTER TABLE SANPHAM
ALTER COLUMN DVT VARCHAR(5)
ALTER TABLE SANPHAM
ADD CONSTRAINT CHK_DVT CHECK (DVT IN ('cay','hop','cai','quyen','chuc'))

--   CAU 8
ALTER TABLE SANPHAM
ADD CONSTRAINT CHK_GIA CHECK (GIA >= 500)

--   CAU 9
ALTER TABLE HOADON 
ADD CONSTRAINT CHK_MUAHANG CHECK (TRIGIA > 0)

--   CAU 10
ALTER TABLE KHACHHANG
ADD CONSTRAINT CHK_NGDK CHECK (NGDK > NGSINH)


--				II. NGON NGU THAO TAC DU LIEU (DATA MANIPULATION LANGUAGE):
--   CAU 1. NHAP DU LIEU:
SET DATEFORMAT DMY

-- BANG KHACHHANG
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH01','Nguyen Van A','731 Tran Hung Dao, Q5, TpHCM','08823451','22/10/1960',13060000,'22/07/2006')
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH02','Tran Ngoc Han','23/5 Nguyen Trai, Q5, TpHCM','0908256478','03/04/1974',280000,'30/07/2006')
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH03','Tran Ngoc Linh','45 Nguyen Canh Chan, Q1, TpHCM','0938776266','12/06/1980',3860000,'08/05/2006')
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH04','Tran Minh Long','50/34 Le Dai Hanh, Q10, TpHCM','0917325476','09/03/1965',250000,'10/02/2006')
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH05','Le Nhat Minh','34 Truong Dinh, Q3, TpHCM','08246108','10/03/1950',21000,'28/10/2006')
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH06','Le Hoai Thuong','227 Nguyen Van Cu, Q5, TpHCM','08631738','31/12/1981',915000,'24/11/2006')
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH07','Nguyen Van Tam','32/3 Tran Binh Trong, Q5, TpHCM','0916783565','06/04/1971',12500,'12/01/2006')
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH08','Phan Thi Thanh','45/2 An Duong Vuong, Q5, TpHCM','0938435756','10/01/1971',365000,'13/12/2006')
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH09','Le Ha Vinh','873 Le Hong Phong, Q5, TpHCM','08654763','03/09/1979',70000,'14/01/2007')
INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES('KH10','Ha Duy Lap','34/34B Nguyen Trai, Q1, TpHCM','08768904','02/05/1983',67500,'16/01/2007')

-- BANG NHANVIEN
INSERT INTO NHANVIEN(MANV, HOTEN, SODT, NGVL) VALUES('NV01','Nguyen Nhu Nhut','927345678','13/04/2006')
INSERT INTO NHANVIEN(MANV, HOTEN, SODT, NGVL) VALUES('NV02','Le Thi Phi Yen','987567390','21/04/2006')
INSERT INTO NHANVIEN(MANV, HOTEN, SODT, NGVL) VALUES('NV03','Nguyen Van B','997047382','27/04/2006')
INSERT INTO NHANVIEN(MANV, HOTEN, SODT, NGVL) VALUES('NV04','Ngo Thanh Tuan','913758498','24/06/2006')
INSERT INTO NHANVIEN(MANV, HOTEN, SODT, NGVL) VALUES('NV05','Nguyen Thi Truc Thanh','918590387','20/07/2006')

-- BANG SANPHAM
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('BC01','But chi','cay','Singapore',3000)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('BC02','But chi','cay','Singapore',5000)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('BC03','But chi','cay','Viet Nam',3500)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('BC04','But chi','hop','Viet Nam',30000)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('BB01','But bi','cay','Viet Nam',5000)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('BB02','But bi','cay','Trung Quoc',7000)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('BB03','But bi','hop','Thai Lan',100000)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('TV01','Tap 100 giay mong','quyen','Trung Quoc',2500)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('TV02','Tap 200 giay mong','quyen','Trung Quoc',4500)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('TV03','Tap 100 giay tot','quyen','Viet Nam',3000)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('TV04','Tap 200 giay tot','quyen','Viet Nam',5500)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('TV05','Tap 100 trang','chuc','Viet Nam',23000)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('TV06','Tap 200 trang','chuc','Viet Nam',53000)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('TV07','Tap 100 trang','chuc','Trung Quoc',34000)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST01','So tay 500 trang','quyen','Trung Quoc',40000)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST02','So tay loai 1','quyen','Viet Nam',55000)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST03','So tay loai 2','quyen','Viet Nam',51000)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST04','So tay','quyen','Thai Lan',55000)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST05','So tay mong','quyen','Thai Lan',20000)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST06','Phan viet bang','hop','Viet Nam',5000)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST07','Phan khong bui','hop','Viet Nam',7000)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST08','Bong bang','cai','Viet Nam',1000)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST09','But long','cay','Viet Nam',5000)
INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES('ST10','But long','cay','Trung Quoc',7000)

-- BANG HOADON
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1001,'23/07/2006','KH01','NV01',320000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1002,'12/08/2006','KH01','NV02',840000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1003,'23/08/2006','KH02','NV01',100000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1004,'01/09/2006','KH02','NV01',180000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1005,'20/10/2006','KH01','NV02',3800000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1006,'16/10/2006','KH01','NV03',2430000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1007,'28/10/2006','KH03','NV03',510000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1008,'28/10/2006','KH01','NV03',440000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1009,'28/10/2006','KH03','NV04',200000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1010,'01/11/2006','KH01','NV01',5200000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1011,'04/11/2006','KH04','NV03',250000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1012,'30/11/2006','KH05','NV03',21000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1013,'12/12/2006','KH06','NV01',5000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1014,'31/12/2006','KH03','NV02',3150000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1015,'01/01/2007','KH06','NV01',910000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1016,'01/01/2007','KH07','NV02',12500)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1017,'02/01/2007','KH08','NV03',35000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1018,'13/01/2007','KH08','NV03',330000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1019,'13/01/2007','KH01','NV03',30000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1020,'14/01/2007','KH09','NV04',70000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1021,'16/01/2007','KH10','NV03',67500)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1022,'16/01/2007',Null,'NV03',7000)
INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES(1023,'17/01/2007',Null,'NV01',330000)

-- BANG CTHD
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1001,'TV02',10)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1001,'ST01',5)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1001,'BC01',5)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1001,'BC02',10)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1001,'ST08',10)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1002,'BC04',20)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1002,'BB01',20)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1002,'BB02',20)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1003,'BB03',10)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1004,'TV01',20)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1004,'TV02',10)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1004,'TV03',10)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1004,'TV04',10)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1005,'TV05',50)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1005,'TV06',50)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1006,'TV07',20)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1006,'ST01',30)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1006,'ST02',10)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1007,'ST03',10)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1008,'ST04',8)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1009,'ST05',10)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1010,'TV07',50)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1010,'ST07',50)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1010,'ST08',100)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1010,'ST04',50)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1010,'TV03',100)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1011,'ST06',50)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1012,'ST07',3)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1013,'ST08',5)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1014,'BC02',80)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1014,'BB02',100)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1014,'BC04',60)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1014,'BB01',50)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1015,'BB02',30)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1015,'BB03',7)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1016,'TV01',5)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1017,'TV02',1)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1017,'TV03',1)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1017,'TV04',5)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1018,'ST04',6)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1019,'ST05',1)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1019,'ST06',2)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1020,'ST07',10)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1021,'ST08',5)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1021,'TV01',7)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1021,'TV02',10)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1022,'ST07',1)
INSERT INTO CTHD(SOHD, MASP, SL) VALUES(1023,'ST04',6)

--   CAU 2
SELECT * INTO SANPHAM1 FROM SANPHAM
SELECT * INTO KHACHHANG1 FROM KHACHHANG

--   CAU 3
UPDATE SANPHAM1
SET GIA = 1.05 * GIA
WHERE NUOCSX = 'Thai Lan'

--   CAU 4
UPDATE SANPHAM1
SET GIA = 0.95 * GIA
WHERE NUOCSX = 'Trung Quoc' AND GIA <= 10000

--   CAU 5
UPDATE KHACHHANG1
SET LOAIKH = 'Vip'
WHERE (NGDK < '1/1/2007' AND DOANHSO >= 10000000) OR (NGDK >= '1/1/2007' AND DOANHSO >= 2000000)

--				III. NGON NGU TRUY VAN DU LIEU:
--   CAU 1
SELECT MASP, TENSP
FROM SANPHAM
WHERE NUOCSX = 'Trung Quoc'

--   CAU 2
SELECT MASP, TENSP
FROM SANPHAM
WHERE DVT IN ('cay', 'quyen')

--   CAU 3
SELECT MASP, TENSP 
FROM SANPHAM
WHERE MASP like 'B%01'

--   CAU 4
SELECT MASP, TENSP
FROM SANPHAM
WHERE (NUOCSX = 'Trung Quoc') AND (GIA BETWEEN 30000 AND 40000)

--   CAU 5
SELECT MASP, TENSP
FROM SANPHAM
WHERE (NUOCSX IN ('Trung Quoc', 'Thai Lan')) AND (GIA BETWEEN 30000 AND 40000)

--   CAU 6
SELECT SOHD, TRIGIA
FROM HOADON
WHERE NGHD  = '1/1/2007' OR NGHD  ='02/01/2007'

--   CAU 7
SELECT SOHD, TRIGIA
FROM HOADON
WHERE MONTH(NGHD) = 1 AND YEAR(NGHD) = 2007
ORDER BY NGHD ASC, TRIGIA DESC

--   CAU 8
SELECT DISTINCT KHACHHANG.MAKH, HOTEN
FROM KHACHHANG, HOADON
WHERE (KHACHHANG.MAKH = HOADON.MAKH) AND (NGHD = '1/1/2007')


--   CAU 9
SELECT SOHD, TRIGIA
FROM HOADON, NHANVIEN
WHERE (HOADON.MANV = NHANVIEN.MANV) AND (HOTEN = 'Nguyen Van B') AND (NGHD = '28/10/2006')

--   CAU 10
SELECT DISTINCT SANPHAM.MASP, TENSP
FROM KHACHHANG, SANPHAM, HOADON, CTHD
WHERE (KHACHHANG.MAKH = HOADON.MAKH) AND (CTHD.SOHD = HOADON.SOHD) AND (CTHD.MASP = SANPHAM.MASP) AND (HOTEN = 'Nguyen Van A') AND (MONTH(NGHD) = 10 AND YEAR(NGHD) = 2006)

--  CAU 11
SELECT DISTINCT SOHD
FROM CTHD
WHERE MASP IN ('BB01', 'BB02')

--  CAU 12
SELECT DISTINCT SOHD
FROM CTHD
WHERE MASP IN ('BB01', 'BB02')
	AND (SL BETWEEN 10 AND 20)

--  CAU 13
SELECT DISTINCT SOHD
FROM CTHD
WHERE MASP = 'BB01'  AND ( SL BETWEEN 10 AND 20 )
INTERSECT
(
	SELECT DISTINCT SOHD
	FROM CTHD
	WHERE MASP = 'BB02' AND SL BETWEEN 10 AND 20
)

--  CAU 14
SELECT DISTINCT SANPHAM.MASP, TENSP
FROM CTHD, SANPHAM, HOADON
WHERE (CTHD.MASP = SANPHAM.MASP) AND (HOADON.SOHD = CTHD.SOHD)
	AND (NGHD = '1/1/2007' OR NUOCSX = 'Trung Quoc')

--  CAU 15
SELECT DISTINCT MASP, TENSP
FROM SANPHAM
WHERE MASP NOT IN ( SELECT MASP
					FROM CTHD)

--  CAU 16
SELECT MASP, TenSP
FROM SANPHAM
WHERE MASP NOT IN ( SELECT MASP 
					FROM CTHD, HOADON
					WHERE CTHD.SOHD = HOADON.SOHD
						AND YEAR(NGHD) = 2006)

--  CAU 17
SELECT MASP, TenSP
FROM SANPHAM
WHERE NUOCSX = 'Trung Quoc' AND MASP NOT IN ( SELECT MASP 
					FROM CTHD, HOADON
					WHERE CTHD.SOHD = HOADON.SOHD
						AND YEAR(NGHD) = 2006)

--  CAU 18
SELECT SOHD
FROM HOADON
WHERE NOT EXISTS (  SELECT *
					FROM SANPHAM
					WHERE NUOCSX = 'Singapore'
						AND NOT EXISTS (SELECT *
										FROM CTHD
										WHERE CTHD.SOHD = HOADON.SOHD
										AND CTHD.MASP = SANPHAM.MASP))

--  CAU 19
SELECT SOHD
FROM HOADON
WHERE YEAR(NGHD) = 2006 
AND NOT EXISTS (SELECT *
				FROM SANPHAM
				WHERE NUOCSX = 'Singapore'
					AND NOT EXISTS (SELECT *
									FROM CTHD
									WHERE CTHD.SOHD = HOADON.SOHD
										AND CTHD.MASP = SANPHAM.MASP))

--  CAU 20
SELECT COUNT(*) 'SL HOA DON KHONG PHAI CUA KHACH HANG DANG KY THANH VIEN MUA'
FROM HOADON
WHERE MAKH IS NULL

--  CAU 21
SELECT COUNT(DISTINCT MASP) 'SL SP KHAC NHAU DUOC BAN RA TRONG NAM 2006'
FROM HOADON, CTHD
WHERE HOADON.SOHD = CTHD.SOHD
	AND YEAR(NGHD) = 2006

--  CAU 22
SELECT MIN(TRIGIA) 'MIN TRIGIA HD', MAX(TRIGia) 'MAX TRI GIA HD'
FROM HOADON

--  CAU 23
SELECT AVG(TRIGIA) 'TRI GIA TB TRONG NAM 2006'
FROM HOADON
WHERE YEAR(NGHD) = 2006

--  CAU 24
SELECT SUM(TRIGIA) "DOANH THU NAM 2006"
FROM HOADON
WHERE YEAR(NGHD) = 2006

--  CAU 25
SELECT SOHD 'SOHD CO TRI GIA CAO NHAT NAM 2006'
FROM HOADON
WHERE YEAR(NGHD) = 2006
	AND TRIGIA = (SELECT MAX(TRIGIA)
				  FROM HOADON
				  WHERE YEAR(NGHD) = 2006)

--  CAU 26
SELECT HOTEN
FROM HOADON, KHACHHANG
WHERE HOADON.MAKH = KHACHHANG.MAKH
	AND YEAR(NGHD) = 2006
	AND TRIGIA = (SELECT MAX(TRIGIA)
				  FROM HOADON
				  WHERE YEAR(NGHD) = 2006)

--  CAU 27
SELECT TOP 3 MAKH, HOTEN
FROM KHACHHANG
ORDER BY DOANHSO DESC

--  CAU 28
SELECT MASP, TENSP
FROM SANPHAM
WHERE GIA IN (SELECT DISTINCT TOP 3 GIA
			  FROM SANPHAM
			  ORDER BY GIA DESC)

--  CAU 29
SELECT MASP, TENSP
FROM SANPHAM
WHERE NUOCSX = 'Thai Lan'
	AND GIA IN (SELECT DISTINCT TOP 3 GIA
			    FROM SANPHAM
			    ORDER BY GIA DESC)

--  CAU 30
SELECT MASP, TENSP
FROM SANPHAM
WHERE NUOCSX = 'Trung Quoc'
	AND GIA IN (SELECT DISTINCT TOP 3 GIA
			    FROM SANPHAM
				WHERE NUOCSX = 'Trung Quoc'
			    ORDER BY GIA DESC)

--  CAU 31
SELECT TOP 3 *
FROM KHACHHANG
ORDER BY DOANHSO DESC

--  CAU 32
SELECT COUNT(*) 'SL SP DO TQ SX'
FROM SANPHAM
WHERE NUOCSX = 'Trung Quoc'

--  CAU 33
SELECT NUOCSX, COUNT(*) 'SL SP'
FROM SANPHAM
GROUP BY NUOCSX

--  CAU 34
SELECT NUOCSX, MAX(GIA) MAX_GIA, MIN(GIA) MIN_GIA, AVG(GIA) AVG_GIA
FROM SANPHAM
GROUP BY NUOCSX

--  CAU 35
SELECT NGHD, SUM(TRIGIA) DOANHTHU_NGAY
FROM HOADON
GROUP BY NGHD

--  CAU 36
SELECT SANPHAM.MASP, SANPHAM.TENSP, SUM(CTHD.SL) SL_SP_BAN
FROM SANPHAM, CTHD, HOADON
WHERE CTHD.MASP = SANPHAM.MASP
	AND HOADON.SOHD = CTHD.SOHD
	AND MONTH(NGHD) = 10 AND YEAR(NGHD) = 2006
GROUP BY SANPHAM.MASP, SANPHAM.TENSP

--  CAU 37
SELECT MONTH(NGHD), SUM(TRIGIA) DOANHTHU_THANG
FROM HOADON
WHERE YEAR(NGHD) = 2006
GROUP BY MONTH(NGHD)

--  CAU 38
SELECT SOHD SOHD_MUA_IT_NHAT_4
FROM CTHD
GROUP BY SOHD
HAVING COUNT(MASP) >= 4

--  CAU 39
SELECT SOHD
FROM  CTHD, SANPHAM
WHERE SANPHAM.MASP = CTHD.MASP
	AND NUOCSX = 'Viet Nam'
GROUP BY SOHD
HAVING COUNT(CTHD.MASP) = 3

--  CAU 40
SELECT KHACHHANG.MAKH, HOTEN
FROM KHACHHANG JOIN HOADON ON HOADON.MAKH = KHACHHANG.MAKH
GROUP BY KHACHHANG.MAKH, HOTEN
HAVING COUNT(*) >= ALL(SELECT COUNT(*) 
					   FROM HOADON
					   GROUP BY MAKH)

--  CAU 41
SELECT MONTH(NGHD) THANG_DOANH_SO_CAO_NHAT 
FROM HOADON
WHERE YEAR(NGHD) = 2006
GROUP BY MONTH(NGHD)
HAVING SUM(TRIGIA) >= ALL(SELECT SUM(TRIGIA)
						  FROM HOADON
						  GROUP BY MONTH(NGHD))

--  CAU 42
SELECT SANPHAM.MASP, SANPHAM.TENSP
FROM SANPHAM JOIN CTHD ON SANPHAM.MASP = CTHD.MASP JOIN HOADON ON HOADON.SOHD = CTHD.SOHD
WHERE YEAR(NGHD) = 2006
GROUP BY SANPHAM.MASP, SANPHAM.TENSP
HAVING SUM(SL) <= ALL(SELECT SUM(SL)
					  FROM SANPHAM JOIN CTHD ON SANPHAM.MASP = CTHD.MASP JOIN HOADON ON HOADON.SOHD = CTHD.SOHD
					  WHERE YEAR(NGHD) = 2006
					  GROUP BY SANPHAM.MASP, SANPHAM.TENSP)

--  CAU 43
SELECT NUOCSX, MASP, TENSP, GIA
FROM SANPHAM SP1
WHERE EXISTS (SELECT NUOCSX
			  FROM SANPHAM SP2
			  GROUP BY NUOCSX
			  HAVING SP1.NUOCSX = SP2.NUOCSX
				AND SP1.GIA = MAX(GIA))

--  CAU 44
SELECT NUOCSX
FROM SANPHAM
GROUP BY NUOCSX
HAVING COUNT(DISTINCT MASP) >=3

--  CAU 45
SELECT KH1.MAKH, KH1.HOTEN
FROM KHACHHANG KH1 JOIN (SELECT TOP 10 MaKH FROM KhachHang ORDER BY KHACHHANG.DOANHSO DESC) AS KH2 ON KH1.MAKH = KH2.MAKH
	JOIN HOADON ON HOADON.MAKH = KH1.MAKH
GROUP BY KH1.MAKH, KH1.HOTEN
HAVING COUNT(SOHD) >= ALL(SELECT COUNT(SOHD)
						  FROM KHACHHANG KH1 JOIN (SELECT TOP 10 MaKH FROM KhachHang ORDER BY KHACHHANG.DOANHSO DESC) AS KH2 ON KH1.MAKH = KH2.MAKH
						  JOIN HOADON ON HOADON.MAKH = KH1.MAKH
						  GROUP BY KH1.MAKH)